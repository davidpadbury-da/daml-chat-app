(window.webpackJsonpui=window.webpackJsonpui||[]).push([[0],{369:function(e,t,n){},370:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(17),c=n.n(s),o=(n(74),n(2)),i=n.n(o),m=n(6),u=n(39),l=n(18),d=n(19),p=n(21),h=n(20),f=n(4),g=n(22),v=function(e){var t;return function(n){JSON.stringify(t)!==JSON.stringify(n)&&(t=n,e(n))}};function b(e,t,n){var a={Authorization:"Bearer ".concat(t)},r={moduleName:"Chat",entityName:"ChatRoom"},s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.assign(t,{method:"POST",headers:a}),fetch(e,t)},c=function(e){return e.sort((function(e,t){return e.timestamp>t.timestamp?1:e.timestamp<t.timestamp?-1:0})),e},o=function(e){var t,n=e.contractId,a=e.argument,r=a.id,s=a.owner,o=a.channelName,i=a.members,m=a.messages;return{id:r,contractId:n,owner:s,channelName:o,members:(t=i,t.sort(),t),messages:c(m.map((function(e){var t=e._1,n=e._2,a=e._3;return{sender:t,timestamp:new Date(n),text:a}})))}},u=function(){var e=Object(m.a)(i.a.mark((function e(){var t,a,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s("/contracts/search",{body:JSON.stringify({"%templates":[r]})});case 3:return t=e.sent,e.next=6,t.json();case 6:a=e.sent,(c=a.result.flatMap((function(e){return e.activeContracts})).map(o)).sort((function(e,t){return e.channelName>t.channelName?1:e.channelName<t.channelName?-1:0})),n(c),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("Fetching next contracts failed",e.t0);case 15:return e.prev=15,setTimeout(u,500),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[0,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),l=function(){var t=Object(m.a)(i.a.mark((function t(n,a){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s("/command/exercise",{body:JSON.stringify({templateId:r,contractId:n.contractId,choice:"Add",argument:{winner:e,message:a}})});case 2:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),d=function(){var t=Object(m.a)(i.a.mark((function t(n){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s("/command/create",{body:JSON.stringify({templateId:r,argument:{id:"".concat(e,"_").concat((new Date).getTime()),owner:e,channelName:n,members:[e],messages:[]}})});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),p=function(){var e=Object(m.a)(i.a.mark((function e(t,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s("/command/exercise",{body:JSON.stringify({templateId:r,contractId:t.contractId,choice:"Invite",argument:{newMember:n}})});case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return u(),{sendMessage:l,createRoom:d,inviteUser:p}}var w=function(e){var t=e.rooms,n=e.currentRoom,a=e.switchToRoom,s=(e.currentUser,t.map((function(e){var t=n&&e.id===n.id?"active":"";return r.a.createElement("li",{className:t,key:e.id,onClick:function(){return a(e.id)}},r.a.createElement("span",{className:"room-icon"},"\ud83c\udf10"),r.a.createElement("span",{className:"room-name"},e.channelName))})));return r.a.createElement("div",{className:"rooms"},r.a.createElement("ul",{className:"chat-rooms"},s))},y=n(375),O=n(62),I=n.n(O),N=n(376),E=n(374),j=function(e){function t(){return Object(l.a)(this,t),Object(p.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props,t=e.language,n=e.value;return r.a.createElement(N.a,{language:"daml"===t?"haskell":t,style:E.a},n||"")}}]),t}(a.PureComponent);j.defaultProps={language:null};var k=j,R=function(e){return e.messages.map((function(e){var t=Object(y.a)(new Date("".concat(e.timestamp)),"HH:mm");return r.a.createElement("li",{className:"message",key:e.timestamp.getTime()},r.a.createElement("div",null,r.a.createElement("span",{className:"user-id"},e.sender),r.a.createElement("span",null,r.a.createElement(I.a,{source:e.text,renderers:{code:k}}))),r.a.createElement("span",{className:"message-time"},t))}))},J=function(e){var t=e.roomUsers,n=(e.currentUser,t.map((function(e){return r.a.createElement("li",{className:"room-member",key:e},r.a.createElement("div",null,r.a.createElement("span",{className:"presence online"}),r.a.createElement("span",null,e)))})));return r.a.createElement("div",{className:"room-users"},r.a.createElement("ul",null,n))},M=n(66),x=n(67),C=n.n(x),S=n(68);n(367),n(368),n(369);function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var D=C.a.parse(window.location.search).party||"Alice",P={Alice:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJsZWRnZXJJZCI6ImNoYXRyb29tIiwiYXBwbGljYXRpb25JZCI6ImZvb2JhciIsInBhcnR5IjoiQWxpY2UifQ.LAYk7tX6OfcyZh5aOPrxlnVwRZ3iqtED3wadpunO45o",Bob:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJsZWRnZXJJZCI6ImNoYXRyb29tIiwiYXBwbGljYXRpb25JZCI6ImZvb2JhciIsInBhcnR5IjoiQm9iIn0.HEdbEnyeApZboQmdrPGJ0-tyqeuLV-XiqpJvcc7qHAw"}[D],T=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(p.a)(this,Object(h.a)(t).call(this))).state={userId:"",showLogin:!0,isLoading:!1,currentUser:D,currentRoom:null,rooms:[],roomUsers:[],roomName:null,messages:[],newMessage:""},e.chatManager=new b(D,P,v((function(t){console.log(t);var n=e.state.currentRoom,a=n&&t.filter((function(e){return e.id===n.id}))[0]||t[0];e.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(n,!0).forEach((function(t){Object(u.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({userId:D,currentUser:D,rooms:t},e.updateCurrentRoomState(a)))}))),e.handleInput=e.handleInput.bind(Object(f.a)(e)),e.sendMessage=e.sendMessage.bind(Object(f.a)(e)),e.updateCurrentRoomState=e.updateCurrentRoomState.bind(Object(f.a)(e)),e.messageKeyDown=e.messageKeyDown.bind(Object(f.a)(e)),e}return Object(g.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){this.scrollToLatestMessages()}},{key:"componentDidUpdate",value:function(){this.scrollToLatestMessages()}},{key:"scrollToLatestMessages",value:function(){M.animateScroll.scrollToBottom({containerId:"chat-messages"})}},{key:"updateCurrentRoomState",value:function(e){return{roomName:e&&e.channelName,currentRoom:e,roomUsers:e&&e.members,messages:e&&e.messages||[]}}},{key:"sendMessage",value:function(e){var t=this;e.preventDefault();var n=this.state,a=n.newMessage,r=(n.currentUser,n.currentRoom);if(""!==a.trim()){var s=/\/(\w+) (.*)/.exec(a),c=s?s[1]:"send",o=s?s[2]:a;switch(c){case"send":this.chatManager.sendMessage(r,o);break;case"create":this.chatManager.createRoom(o);break;case"invite":this.chatManager.inviteUser(r,o);break;case"giphy":fetch("//api.giphy.com/v1/gifs/random?api_key=".concat("kDqbzOZtPvy38TLdqonPnpTPrsLfW8uy","&tag=").concat(encodeURIComponent(o))).then(function(){var e=Object(m.a)(i.a.mark((function e(n){var a,s,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.json();case 2:a=e.sent,s=a.data.fixed_height_downsampled_url,c="![".concat(o,"](").concat(s,")"),t.chatManager.sendMessage(r,c);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());break;default:console.log("Unknown command",c)}this.setState({newMessage:""})}}},{key:"handleInput",value:function(e){var t=e.target,n=t.name,a=t.value;this.setState(Object(u.a)({},n,a))}},{key:"messageKeyDown",value:function(e){if(13===e.keyCode)if(e.preventDefault(),e.ctrlKey){var t=this.state.newMessage;this.setState({newMessage:t+"\n"})}else this.sendMessage(e)}},{key:"switchToRoom",value:function(e){var t=this.state.rooms.filter((function(t){return t.id==e}))[0];this.setState(this.updateCurrentRoomState(t))}},{key:"render",value:function(){var e=this.state,t=(e.userId,e.showLogin,e.rooms),n=e.currentRoom,a=e.currentUser,s=e.messages,c=e.newMessage,o=e.roomUsers;e.roomName;return r.a.createElement("div",{className:"App"},r.a.createElement("aside",{className:"sidebar left-sidebar"},a?r.a.createElement("div",{className:"user-profile"},r.a.createElement("span",{className:"username"},"@".concat(a))):null,t?r.a.createElement(w,{rooms:t,currentRoom:n,switchToRoom:this.switchToRoom.bind(this),currentUser:a}):null),r.a.createElement("section",{className:"chat-screen"},r.a.createElement("header",{className:"chat-header"},n?r.a.createElement("h3",null,n.channelName):null),r.a.createElement("ul",{className:"chat-messages",id:"chat-messages"},r.a.createElement(R,{messages:s})),r.a.createElement("footer",{className:"chat-footer"},r.a.createElement("fieldset",null,r.a.createElement("form",{className:"message-form",autoComplete:"off",onSubmit:this.sendMessage},r.a.createElement(S.a,{minRows:1,maxRows:3,value:c,name:"newMessage",className:"message-input",placeholder:"Type your message and hit ENTER to send",onChange:this.handleInput,onKeyDown:this.messageKeyDown,resize:"none"}))))),r.a.createElement("aside",{className:"sidebar right-sidebar"},n?r.a.createElement(J,{currentUser:a,roomUsers:o}):null))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(T,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},69:function(e,t,n){e.exports=n(370)},74:function(e,t,n){}},[[69,1,2]]]);
//# sourceMappingURL=main.79ef9d67.chunk.js.map